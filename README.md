## Hierarchically embedded scales of movement shape the social networks of vampire bats, Version 1

# Description
This project analyzed the relation between social connectedness and hierarchically embedded scales of movement using both real and simulated data of the common vampire bat. Included are the raw empirical data, simulated data, NetLogo models, and R code used to analyze the data and create graphs.

This is a repository of all data files and scripts used to study how movement at multiple, hierarchically embedded scales of movement affects the centrality of vampire bats. For a full description, please see the associated paper (or preprint), "Hierarchically embedded scales of movement shape the social networks of vampire bats" by [hidden for double-blind peer review]. Please contact [hidden for peer review] if you have any questions, comments, or concerns.

# File Summaries and Instructions

All necessary R packages and NetLogo extensions are listed at the top of each R and NetLogo file, respectively. Filepaths will need to be edited to properly run code, however, most files should be ready to run unless otherwise stated.

This project is broken into subsections, each performing a different analysis or having a different function.

To run the entire analysis, start by entering the roost-switching folder and download the roosting_information.csv. This file contains observations of roost-level associations, noting the time, place, and identity of bats in particular roosts (collected for the studies "Reciprocal Food Sharing in the Vampire Bat" and "The Social Organization of the Common Vampire Bat: I. Pattern and Cause of Association," both by Gerald S. Wilkinson). Then, download and run roost_switching.R, which will modify the original dataset to mark every observation of each bat to show whether a roost switch occurred, as well as how long it has been since this bat was observed switching roosts. This will generate the roost_switching.csv file. Alternatively, the roost_switching.csv file can be downloaded for direct analysis.

Concurrently, the clustering_information.Rdata file can be downloaded from the cluster-switching folder, which shows the positions of bats in different corners of a roost in a captive colony of vampire bats (collected for the study "Non-Kin Adoption in the Common Vampire Bat," by Imran Razik, Bridget K. G. Brown, Rachel A. Page, and Gerald G. Carter). The cluster_switching.R code can then be run, which modifies the original dataset to denote the position of each bat, as well as whether a cluster switch occurred in each observation of the bat and the time since last cluster switch. This data is then outputted as cluster_switching.csv, which can alternatively be downloaded directly.

Finally, the events.Rdata file can be downloaded from the partner-switching folder, which shows a log of the grooming events for all bats in the same study of captive vampire bats ("Non-Kin Adoption in the Common Vampire Bat," by Imran Razik, Bridget K. G. Brown, Rachel A. Page, and Gerald G. Carter). The partner_switching.R code can then be run, which marks whether a bat has switched partners and time since last partner switch for each bat in the study. This data is outputted as partner_switching.csv, which can also be downloaded directly.

The roost_switching.csv, cluster_switching.csv, and partner_switching.csv files are required to run the get_switch_prob-03.R file, located in the switching-probabilities folder. This R script takes the datasets generated by the previously mentioned scripts, and creates three datasets that show the probability of switching at a particular scale based on time since last switch at that scale. In these datasets, rows represent different individual vampire bats from empirical data collection, and each column represents a different time since last switch (days for roost switching, hour for cluster switching, minute for partner switching). These files are outputted as roost_switching_probs.csv, cluster_switching_probs.csv, and partner_switching_probs.csv, which can all also be alternatively downloaded directly from the switching-probabilities folder.

The data from roost_switching_probs.csv, cluster_switching_probs.csv, and partner_switching_probs.csv have all been manually inputted into the relevant files that require them as an input. In the NetLogo-models folder, there are two NetLogo files, roost-correlated.nlogo and roost-uncorrelated.nlogo. Both files run an agent-based model where individual vampire bats move at empirically-derived roost switching, cluster switching, and partner switching rates, while the number of switches at each scale and the number of grooming partners is monitored by bat. These files differ only in that switching rates are correlated is roost-correlateed.nlogo, and not correlated in roost-uncorrelated.nlogo (the switching probability matrices in roost-correlated.nlogo are modified so all matrices have the same number of rows, see the supplement of "Hierarchically embedded scales of movement shape the social networks of vampire bats" by [hidden for peer review]). The number of bats (100 or 200) needs to be manually manipulated by entering the code and changing the value of "Bats." Additionally, whether switching probabilities are variable by bat can be edited in the roost-uncorrelated.R code by commenting out "set roost-switch-vector matrix:get-row  roost-switch-matrix b" and leaving in "set roost-switch-vector matrix:get-row rs-mean-matrix 0" (or cluster, partner) in the setup section to make that switching type non-variable (or vice versa, to make that switcing probability variable). This code generates association data, showing where vampire bats resided each minute, and interaction data, showing a list of all grooming interactions each bat had during the course of the simulation.

Two additional NetLogo models are also found in the same folder. roost-no-scales.nlogo removes scales of movement, effectively putting all bats in the same cluster. roost-nothing.nlogo gets rid of partner switching propensities, allowing bats to groom whoever without a desire to stay with the same partner. These were used for Fig 5.

Two more NetLogo models were made, roost-uncorrelated2.nlogo and roost-uncorrelated3.nlogo, which are both faster than the original, and additionally output either a file showing the cluster and hour of each interaction or the roost and day of each interaction, respectively. These were used for Fig 6.

The outputs of the NetLogo models are the association and interaction data files, as decribed above, which can be found in the associations folder and interactions folder. These are broken down further into groups of 100. Files 0-99 represent the output of the uncorrelated data file, with all variable movement probabilities, and 200 bats. Files 100-199, uncorrelated, variable roost switching, 200 bats. 200-299, uncorrelated, variable cluster switching, 200 bats. 300-399, uncorrelated, variable partner switching, 200 bats. 400-499, correlated, 200 bats. 500-599, uncorrelated, all variable, 100 bats. Files 600-699, uncorrelated, variable roost switching, 100 bats. 700-799, uncorrelated, variable cluster switching, 100 bats. 800-899, uncorrelated, variable partner switching, 100 bats. 900-999, correlated, 100 bats. These all can be downloaded for direct analysis.

The graphs and analysis folder shows the analysis and plotting code required to make each graph in the paper, "Hierarchically embedded scales of movement shape the social networks of vampire bats" by [hidden for peer review].

The model results are analyzed in via scales_of_movement02.R, found in the Fig3_Fig4_FigS3_FigS4 folder in the graphs_and_analysis folder. This code analyzes a subsection of the interaction data files, and outputs the effects of switching rate (standardized coefficients of switching rate) on degree and pagerank. To use this code, the name of the output file and input files must be specified. We used the convention of analyzing by groups of 100. degree_est0.csv was the output of analyzing interactions0.csv through interactions99.csv, and degree_est1.csv was the output of analyzing interaction100.csv through interactions199.csv and so on. degree_est0.csv through degree_est9.csv can be found under the Fig3_Fig4_FigS3_FigS4 folder. pagerank_est0.csv through pagerank_est9.csv can likewise be found in the FigS3_FigS4_a-e folder. Fig3_Fig4_FigS3_FigS4.R and FigS5_FigS6.R create violin-box-and-whisker plots that visualize the effect of movement rates on degree and pagerank, respectively, in 5 different scenarios.

The other folders contain code relevant for analysis of the empirical data. The Fig5 folder contains social_diff.R, which produces the csv files found in the Fig5 folder (obs.csv, exp548.csv, exp2400.csv, exp2401.csv, exp2402.csv, exp2403.csv, which represent the social differentiation of actual networks generated by the model, then the permutations with 5 different restrictions on the model). These are used to generate Fig 5 with Fig5.R, which shows the social differentiation from the agent-based grooming network and the associated permutation with no modification, with no hierarchically embedded scales of movement, no individual variation in partner switching propensities, no partner switching propensities, and no variation in realized grooming rate. Additionally, it produces the csv files in Fig6 (obs2.csv, exp2404.csv, and exp2405, which represent social differentiation of actual networks generated by the model, semi-constrained permutations, and fully constrained permutations, respectively). These (and exp548.csv) are used to generat Fig 6 with Fig6.R, which shows social differentiation from the agent-based mgrooming network and the associated permutations with additional constraints.

The FigS1 folder contains consecutive.R, which take the original data files (roosting_information.csv, clustering_information.Rdata, events.Rdata) and find the mean switching rate for every bat in those data files (outputted as roost_sw.csv, cluster_sw.csv, partner_sw.csv, and partners_sw2.csv, which is within-cluster partner switching). FigS1.R plots this data as a histogram.

Then, centrality.R in the Fig2 folder uses the datafiles generated by consecutive.R, as well as partner_switching.csv and transcribe.csv (collected for the studies "Reciprocal Food Sharing in the Vampire Bat" and "The Social Organization of the Common Vampire Bat: I. Pattern and Cause of Association," both by Gerald S. Wilkinson), to output data files (gd.csv for cluster and partner switching, centrality.csv for roost switching) that have the centrality and switching rate for all bats we have data on both. Fig2.R creates three linear model plots showing the relationship between degree centrality and movement rate at each scale.

The FigS2 folder only contains FigS2.R, which requires gd.csv to create a linear model plot showing the relationship between within-cluster partner switching and cluster switching.
